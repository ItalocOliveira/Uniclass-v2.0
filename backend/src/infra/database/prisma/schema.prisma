generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  extensions = [postgis()]
}


model Instituicao {
  instituicao_id String   @id @default(uuid()) @db.Uuid
  nome           String
  logo_url       String
  mapa_url       String?
  coordenadas    Json?

  locais   Local[]
  usuarios Usuario[]
  avisos   Aviso[]
  eventos  Evento[]
  sugestoes Sugestao[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("instituicoes")
}

model Local {
  local_id        String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  nome            String
  tipo            localTipos
  bloco           String?
  mapa_xy         Json?
  acessivel       Boolean?  @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id], onDelete: Cascade)
  eventos Evento[]

  @@unique([local_id, instituicao_id])
  @@map("locais")
}

model Usuario {
  usuario_id      String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  nome            String
  email           String   
  senha_hash      String
  tipo_acesso     TipoAcesso
  curso           String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id], onDelete: Cascade)
  avisos Aviso[]
  sugestoes Sugestao[]

  @@map("usuarios")

  @@unique([usuario_id, instituicao_id]) 
}

model Aviso {
  aviso_id        String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  usuario_id      String  @db.Uuid
  usuario_nome    String
  titulo          String
  mensagem        String?
  prioridade      avisoPrioridade
  curso_alvo      String[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  usuario Usuario? @relation(fields: [usuario_id], references: [usuario_id])

  @@unique([aviso_id, instituicao_id])
  @@map("avisos")
}

model Evento {
  evento_id       String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  titulo          String
  data            DateTime
  tipo            eventoTipos
  descricao       String?
  local_id        String?  @db.Uuid

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  local Local? @relation(fields: [local_id], references: [local_id], onDelete: SetNull)

  @@unique([evento_id, instituicao_id])
  @@map("eventos")
}

model Sugestao {
  sugestao_id     String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  usuario_id      String   @db.Uuid
  titulo          String
  descricao       String?
  tipo            sugestaoTipos
  mapa_xy         Json?
  status          sugestaoStatus
  foto_url        String?

  created_at    DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  usuario Usuario @relation(fields: [usuario_id], references: [usuario_id])

  @@unique([sugestao_id, instituicao_id])
  @@map("sugestoes")
}

enum TipoAcesso {
  ADMIN
  PROFESSOR
  ALUNO
}

enum localTipos {
  BLOCO
  COMERCIO
  BIBLIOTECA
  REITORIA
  COORDENACAO
  PRACA
  AUDITORIO
}

enum sugestaoTipos {
  CONSERTO
  REPOSICAO_MATERIAL
  INSTALACAO
  ATUALIZACAO
  SUPORTE_TECNICO
}

enum sugestaoStatus {
  PENDENTE
  EM_ATENDIMENTO
  RESOLVIDO
}

enum eventoTipos {
  PALESTRA
  FEIRA
  MOCHILAO
  WORKSHOP
  SEMINARIO
  MEETUP
  HACKATON
}

enum avisoPrioridade {
  LEVE 
  MODERADO 
  IMPORTANTE 
  URGENTE
}
