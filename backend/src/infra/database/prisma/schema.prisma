generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model Instituicao {
  instituicao_id String   @id @default(uuid()) @db.Uuid
  nome           String
  logo_url       String?
  mapa_url       String?

  locais   Local[]
  usuarios Usuario[]
  avisos   Aviso[]
  eventos  Evento[]
  sugestoes Sugestao[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("instituicoes")
}

model Local {
  local_id        String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  nome            String
  tipo            localTipos
  bloco           String
  coordenadas     Unsupported("geometry(Point, 4326)")?
  mapa_xy         Json?
  acessivel       Boolean  @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  eventos Evento[]

  @@map("locais")
}

model Usuario {
  usuario_id      String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  nome            String
  email           String   
  senha_hash      String
  tipo_acesso     TipoAcesso
  curso           String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  avisos Aviso[]
  sugestoes Sugestao[]

  @@map("usuarios")

  @@unique([email, instituicao_id]) 
}

model Aviso {
  aviso_id        String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  usuario_id      String?  @db.Uuid
  usuario_nome    String?
  titulo          String
  mensagem        String?
  prioridade      avisoPrioridade
  curso_alvo      String[]

  created_at DateTime @default(now())
  update_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  usuario Usuario? @relation(fields: [usuario_id], references: [usuario_id])

  @@map("avisos")
}

model Evento {
  evento_id       String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  titulo          String
  data            DateTime
  tipo            eventoTipos
  descricao       String?
  local_id        String?  @db.Uuid

  created_at DateTime @default(now())
  update_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  local Local? @relation(fields: [local_id], references: [local_id])

  @@map("eventos")
}

model Sugestao {
  sugestao_id     String   @id @default(uuid()) @db.Uuid
  instituicao_id  String   @db.Uuid
  usuario_id      String   @db.Uuid
  titulo          String
  descricao       String?
  tipo            sugestaoTipos
  status          String
  localizacao     Unsupported("geometry(Point, 4326)")?
  foto_url        String?

  created_at    DateTime @default(now())
  update_at DateTime @updatedAt

  instituicao Instituicao @relation(fields: [instituicao_id], references: [instituicao_id])
  usuario Usuario @relation(fields: [usuario_id], references: [usuario_id])

  @@map("sugestoes")
}

enum TipoAcesso {
  ADMIN
  PROFESSOR
  ALUNO
}

enum localTipos {
  BLOCO
  COMERCIO
  BIBLIOTECA
  REITORIA
  COORDENACAO
  PRACA
  AUDITORIO
}

enum sugestaoTipos {
  CONSERTO
  REPOSICAO_MATERIAL
  INSTALACAO
  ATUALIZACAO
  SUPORTE_TECNICO
}

enum eventoTipos {
  PALESTRA
  FEIRA
  MOCHILAO
  WORKSHOP
  SEMINARIO
  MEETUP
  HACKATON
}

enum avisoPrioridade {
  LEVE 
  MODERADO 
  IMPORTANTE 
  URGENTE
}
